function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React, { useState, useEffect, useRef, useCallback, useContext, createContext } from "react";
import useForceUpdate from "use-force-update";
import dotnetify from "dotnetify";
const DotNetifyContext = createContext({
  states: {
    current: {}
  },
  vms: {
    current: {}
  },
  update: (model, newState) => {
    throw new Error(`${model} not initialized: ${newState}`);
  }
});
export const DotNetifyProvider = props => {
  const vms = useRef({});
  const states = useRef({});
  const forceUpdate = useForceUpdate();
  vms.current = dotnetify.react.getViewModels() // @ts-ignore
  .reduce((prev, curr) => _objectSpread({}, prev, {
    [curr.$vmId]: curr
  }), {});
  const update = useCallback((model, newState) => {
    states.current = _objectSpread({}, states.current, {
      [model]: newState
    });
    forceUpdate();
  }, [forceUpdate]);
  return React.createElement(DotNetifyContext.Provider, {
    value: {
      vms,
      states,
      update
    }
  }, props.children);
};
export function useDotNetify(model, initialState) {
  const {
    vms,
    states,
    update
  } = useContext(DotNetifyContext);

  if (!states.current[model]) {
    update(model, initialState);
  }

  useEffect(() => {
    let vm = vms.current[model];

    if (vm === undefined) {
      const component = {
        state: states.current[model],
        setState: newState => {
          update(model, newState);
        }
      };
      vm = dotnetify.react.connect(model, component, {
        getState: () => states.current[model],
        setState: newState => {
          update(model, newState);
        }
      });
    }

    return () => vm && vm.$destroy();
  }, [model, vms, states, update]);
  return [states.current[model], vms.current[model]];
}
export function useProperty(model, property) {
  const {
    vms,
    states
  } = useContext(DotNetifyContext);
  const [value, setValue] = useState(states.current[model][property]);
  const didChange = useRef(false);

  const update = value => {
    setValue(value);
    didChange.current = true;
  };

  const dispatch = value => {
    debugger;

    if (vms.current[model] === undefined) {
      throw new Error("Unable to dispatch, vm has not been initialized.");
    }

    vms.current[model].$dispatch({
      [property]: value
    });
    didChange.current = true;
  };

  const state = states.current[model];
  useEffect(() => {
    if (value !== state[property] && !didChange.current) {
      setValue(state[property]);
      didChange.current = false;
    }
  }, [model, property, state, value]);
  return [value, update, dispatch];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQvdXNlLWRvdG5ldGlmeS50c3giXSwibmFtZXMiOlsiUmVhY3QiLCJ1c2VTdGF0ZSIsInVzZUVmZmVjdCIsInVzZVJlZiIsInVzZUNhbGxiYWNrIiwidXNlQ29udGV4dCIsImNyZWF0ZUNvbnRleHQiLCJ1c2VGb3JjZVVwZGF0ZSIsImRvdG5ldGlmeSIsIkRvdE5ldGlmeUNvbnRleHQiLCJzdGF0ZXMiLCJjdXJyZW50Iiwidm1zIiwidXBkYXRlIiwibW9kZWwiLCJuZXdTdGF0ZSIsIkVycm9yIiwiRG90TmV0aWZ5UHJvdmlkZXIiLCJwcm9wcyIsImZvcmNlVXBkYXRlIiwicmVhY3QiLCJnZXRWaWV3TW9kZWxzIiwicmVkdWNlIiwicHJldiIsImN1cnIiLCIkdm1JZCIsImNoaWxkcmVuIiwidXNlRG90TmV0aWZ5IiwiaW5pdGlhbFN0YXRlIiwidm0iLCJ1bmRlZmluZWQiLCJjb21wb25lbnQiLCJzdGF0ZSIsInNldFN0YXRlIiwiY29ubmVjdCIsImdldFN0YXRlIiwiJGRlc3Ryb3kiLCJ1c2VQcm9wZXJ0eSIsInByb3BlcnR5IiwidmFsdWUiLCJzZXRWYWx1ZSIsImRpZENoYW5nZSIsImRpc3BhdGNoIiwiJGRpc3BhdGNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPQSxLQUFQLElBQ0VDLFFBREYsRUFFRUMsU0FGRixFQUdFQyxNQUhGLEVBSUVDLFdBSkYsRUFLRUMsVUFMRixFQU1FQyxhQU5GLFFBVU8sT0FWUDtBQVdBLE9BQU9DLGNBQVAsTUFBMkIsa0JBQTNCO0FBQ0EsT0FBT0MsU0FBUCxNQUF1QyxXQUF2QztBQVFBLE1BQU1DLGdCQUFnQixHQUFHSCxhQUFhLENBQXdCO0FBQzVESSxFQUFBQSxNQUFNLEVBQUU7QUFBRUMsSUFBQUEsT0FBTyxFQUFFO0FBQVgsR0FEb0Q7QUFFNURDLEVBQUFBLEdBQUcsRUFBRTtBQUFFRCxJQUFBQSxPQUFPLEVBQUU7QUFBWCxHQUZ1RDtBQUc1REUsRUFBQUEsTUFBTSxFQUFFLENBQUNDLEtBQUQsRUFBZ0JDLFFBQWhCLEtBQWtDO0FBQ3hDLFVBQU0sSUFBSUMsS0FBSixDQUFXLEdBQUVGLEtBQU0scUJBQW9CQyxRQUFTLEVBQWhELENBQU47QUFDRDtBQUwyRCxDQUF4QixDQUF0QztBQVFBLE9BQU8sTUFBTUUsaUJBQXFCLEdBQUdDLEtBQUssSUFBSTtBQUM1QyxRQUFNTixHQUFHLEdBQUdULE1BQU0sQ0FBQyxFQUFELENBQWxCO0FBQ0EsUUFBTU8sTUFBTSxHQUFHUCxNQUFNLENBQUMsRUFBRCxDQUFyQjtBQUNBLFFBQU1nQixXQUFXLEdBQUdaLGNBQWMsRUFBbEM7QUFFQUssRUFBQUEsR0FBRyxDQUFDRCxPQUFKLEdBQWNILFNBQVMsQ0FBQ1ksS0FBVixDQUNYQyxhQURXLEdBRVo7QUFGWSxHQUdYQyxNQUhXLENBR0osQ0FBQ0MsSUFBRCxFQUFPQyxJQUFQLHVCQUFzQkQsSUFBdEI7QUFBNEIsS0FBQ0MsSUFBSSxDQUFDQyxLQUFOLEdBQWNEO0FBQTFDLElBSEksRUFHK0MsRUFIL0MsQ0FBZDtBQUtBLFFBQU1YLE1BQU0sR0FBR1QsV0FBVyxDQUN4QixDQUFDVSxLQUFELEVBQVFDLFFBQVIsS0FBcUI7QUFDbkJMLElBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxxQkFDS0QsTUFBTSxDQUFDQyxPQURaO0FBRUUsT0FBQ0csS0FBRCxHQUFTQztBQUZYO0FBSUFJLElBQUFBLFdBQVc7QUFDWixHQVB1QixFQVF4QixDQUFDQSxXQUFELENBUndCLENBQTFCO0FBV0EsU0FDRSxvQkFBQyxnQkFBRCxDQUFrQixRQUFsQjtBQUEyQixJQUFBLEtBQUssRUFBRTtBQUFFUCxNQUFBQSxHQUFGO0FBQU9GLE1BQUFBLE1BQVA7QUFBZUcsTUFBQUE7QUFBZjtBQUFsQyxLQUNHSyxLQUFLLENBQUNRLFFBRFQsQ0FERjtBQUtELENBMUJNO0FBNEJQLE9BQU8sU0FBU0MsWUFBVCxDQUF5QmIsS0FBekIsRUFBd0NjLFlBQXhDLEVBQXlEO0FBQzlELFFBQU07QUFBRWhCLElBQUFBLEdBQUY7QUFBT0YsSUFBQUEsTUFBUDtBQUFlRyxJQUFBQTtBQUFmLE1BQTBCUixVQUFVLENBQUNJLGdCQUFELENBQTFDOztBQUVBLE1BQUksQ0FBQ0MsTUFBTSxDQUFDQyxPQUFQLENBQWVHLEtBQWYsQ0FBTCxFQUE0QjtBQUMxQkQsSUFBQUEsTUFBTSxDQUFDQyxLQUFELEVBQVFjLFlBQVIsQ0FBTjtBQUNEOztBQUVEMUIsRUFBQUEsU0FBUyxDQUFDLE1BQU07QUFDZCxRQUFJMkIsRUFBRSxHQUFHakIsR0FBRyxDQUFDRCxPQUFKLENBQVlHLEtBQVosQ0FBVDs7QUFFQSxRQUFJZSxFQUFFLEtBQUtDLFNBQVgsRUFBc0I7QUFDcEIsWUFBTUMsU0FBUyxHQUFHO0FBQ2hCQyxRQUFBQSxLQUFLLEVBQUV0QixNQUFNLENBQUNDLE9BQVAsQ0FBZUcsS0FBZixDQURTO0FBRWhCbUIsUUFBQUEsUUFBUSxFQUFHbEIsUUFBRCxJQUFpQjtBQUN6QkYsVUFBQUEsTUFBTSxDQUFDQyxLQUFELEVBQVFDLFFBQVIsQ0FBTjtBQUNEO0FBSmUsT0FBbEI7QUFPQWMsTUFBQUEsRUFBRSxHQUFHckIsU0FBUyxDQUFDWSxLQUFWLENBQWdCYyxPQUFoQixDQUF3QnBCLEtBQXhCLEVBQStCaUIsU0FBL0IsRUFBdUQ7QUFDMURJLFFBQUFBLFFBQVEsRUFBRSxNQUFNekIsTUFBTSxDQUFDQyxPQUFQLENBQWVHLEtBQWYsQ0FEMEM7QUFFMURtQixRQUFBQSxRQUFRLEVBQUVsQixRQUFRLElBQUk7QUFDcEJGLFVBQUFBLE1BQU0sQ0FBQ0MsS0FBRCxFQUFRQyxRQUFSLENBQU47QUFDRDtBQUp5RCxPQUF2RCxDQUFMO0FBTUQ7O0FBRUQsV0FBTyxNQUFNYyxFQUFFLElBQUlBLEVBQUUsQ0FBQ08sUUFBSCxFQUFuQjtBQUNELEdBcEJRLEVBb0JOLENBQUN0QixLQUFELEVBQVFGLEdBQVIsRUFBYUYsTUFBYixFQUFxQkcsTUFBckIsQ0FwQk0sQ0FBVDtBQXNCQSxTQUFPLENBQUNILE1BQU0sQ0FBQ0MsT0FBUCxDQUFlRyxLQUFmLENBQUQsRUFBd0JGLEdBQUcsQ0FBQ0QsT0FBSixDQUFZRyxLQUFaLENBQXhCLENBQVA7QUFDRDtBQUVELE9BQU8sU0FBU3VCLFdBQVQsQ0FBcUJ2QixLQUFyQixFQUFvQ3dCLFFBQXBDLEVBQXNEO0FBQzNELFFBQU07QUFBRTFCLElBQUFBLEdBQUY7QUFBT0YsSUFBQUE7QUFBUCxNQUFrQkwsVUFBVSxDQUFDSSxnQkFBRCxDQUFsQztBQUNBLFFBQU0sQ0FBQzhCLEtBQUQsRUFBUUMsUUFBUixJQUFvQnZDLFFBQVEsQ0FBQ1MsTUFBTSxDQUFDQyxPQUFQLENBQWVHLEtBQWYsRUFBc0J3QixRQUF0QixDQUFELENBQWxDO0FBQ0EsUUFBTUcsU0FBUyxHQUFHdEMsTUFBTSxDQUFDLEtBQUQsQ0FBeEI7O0FBRUEsUUFBTVUsTUFBTSxHQUFJMEIsS0FBRCxJQUFnQjtBQUM3QkMsSUFBQUEsUUFBUSxDQUFDRCxLQUFELENBQVI7QUFDQUUsSUFBQUEsU0FBUyxDQUFDOUIsT0FBVixHQUFvQixJQUFwQjtBQUNELEdBSEQ7O0FBS0EsUUFBTStCLFFBQVEsR0FBSUgsS0FBRCxJQUFnQjtBQUMvQjs7QUFDQSxRQUFJM0IsR0FBRyxDQUFDRCxPQUFKLENBQVlHLEtBQVosTUFBdUJnQixTQUEzQixFQUFzQztBQUNwQyxZQUFNLElBQUlkLEtBQUosQ0FBVSxrREFBVixDQUFOO0FBQ0Q7O0FBRURKLElBQUFBLEdBQUcsQ0FBQ0QsT0FBSixDQUFZRyxLQUFaLEVBQW1CNkIsU0FBbkIsQ0FBNkI7QUFBRSxPQUFDTCxRQUFELEdBQVlDO0FBQWQsS0FBN0I7QUFDQUUsSUFBQUEsU0FBUyxDQUFDOUIsT0FBVixHQUFvQixJQUFwQjtBQUNELEdBUkQ7O0FBVUEsUUFBTXFCLEtBQUssR0FBR3RCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlRyxLQUFmLENBQWQ7QUFFQVosRUFBQUEsU0FBUyxDQUFDLE1BQU07QUFDZCxRQUFJcUMsS0FBSyxLQUFLUCxLQUFLLENBQUNNLFFBQUQsQ0FBZixJQUE2QixDQUFDRyxTQUFTLENBQUM5QixPQUE1QyxFQUFxRDtBQUNuRDZCLE1BQUFBLFFBQVEsQ0FBQ1IsS0FBSyxDQUFDTSxRQUFELENBQU4sQ0FBUjtBQUNBRyxNQUFBQSxTQUFTLENBQUM5QixPQUFWLEdBQW9CLEtBQXBCO0FBQ0Q7QUFDRixHQUxRLEVBS04sQ0FBQ0csS0FBRCxFQUFRd0IsUUFBUixFQUFrQk4sS0FBbEIsRUFBeUJPLEtBQXpCLENBTE0sQ0FBVDtBQU9BLFNBQU8sQ0FBQ0EsS0FBRCxFQUFRMUIsTUFBUixFQUFnQjZCLFFBQWhCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xyXG4gIHVzZVN0YXRlLFxyXG4gIHVzZUVmZmVjdCxcclxuICB1c2VSZWYsXHJcbiAgdXNlQ2FsbGJhY2ssXHJcbiAgdXNlQ29udGV4dCxcclxuICBjcmVhdGVDb250ZXh0LFxyXG4gIE11dGFibGVSZWZPYmplY3QsXHJcbiAgRkMsXHJcbiAgQ29tcG9uZW50LFxyXG59IGZyb20gXCJyZWFjdFwiXHJcbmltcG9ydCB1c2VGb3JjZVVwZGF0ZSBmcm9tIFwidXNlLWZvcmNlLXVwZGF0ZVwiXHJcbmltcG9ydCBkb3RuZXRpZnksIHsgZG90bmV0aWZ5Vk0gfSBmcm9tIFwiZG90bmV0aWZ5XCJcclxuXHJcbnR5cGUgRG90TmV0aWZ5Q29udGV4dFByb3BzID0ge1xyXG4gIHN0YXRlczogTXV0YWJsZVJlZk9iamVjdDx7IFtrZXk6IHN0cmluZ106IHsgW2tleTogc3RyaW5nXTogYW55IH0gfT5cclxuICB2bXM6IE11dGFibGVSZWZPYmplY3Q8eyBba2V5OiBzdHJpbmddOiBkb3RuZXRpZnlWTSB9PlxyXG4gIHVwZGF0ZTogKG1vZGVsOiBzdHJpbmcsIG5ld1N0YXRlOiBhbnkpID0+IHZvaWRcclxufVxyXG5cclxuY29uc3QgRG90TmV0aWZ5Q29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8RG90TmV0aWZ5Q29udGV4dFByb3BzPih7XHJcbiAgc3RhdGVzOiB7IGN1cnJlbnQ6IHt9IH0sXHJcbiAgdm1zOiB7IGN1cnJlbnQ6IHt9IH0sXHJcbiAgdXBkYXRlOiAobW9kZWw6IHN0cmluZywgbmV3U3RhdGU6IGFueSkgPT4ge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21vZGVsfSBub3QgaW5pdGlhbGl6ZWQ6ICR7bmV3U3RhdGV9YClcclxuICB9LFxyXG59KVxyXG5cclxuZXhwb3J0IGNvbnN0IERvdE5ldGlmeVByb3ZpZGVyOiBGQyA9IHByb3BzID0+IHtcclxuICBjb25zdCB2bXMgPSB1c2VSZWYoe30pXHJcbiAgY29uc3Qgc3RhdGVzID0gdXNlUmVmKHt9KVxyXG4gIGNvbnN0IGZvcmNlVXBkYXRlID0gdXNlRm9yY2VVcGRhdGUoKVxyXG5cclxuICB2bXMuY3VycmVudCA9IGRvdG5ldGlmeS5yZWFjdFxyXG4gICAgLmdldFZpZXdNb2RlbHMoKVxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgLnJlZHVjZSgocHJldiwgY3VycikgPT4gKHsgLi4ucHJldiwgW2N1cnIuJHZtSWRdOiBjdXJyIH0pLCB7fSlcclxuXHJcbiAgY29uc3QgdXBkYXRlID0gdXNlQ2FsbGJhY2soXHJcbiAgICAobW9kZWwsIG5ld1N0YXRlKSA9PiB7XHJcbiAgICAgIHN0YXRlcy5jdXJyZW50ID0ge1xyXG4gICAgICAgIC4uLnN0YXRlcy5jdXJyZW50LFxyXG4gICAgICAgIFttb2RlbF06IG5ld1N0YXRlLFxyXG4gICAgICB9XHJcbiAgICAgIGZvcmNlVXBkYXRlKClcclxuICAgIH0sXHJcbiAgICBbZm9yY2VVcGRhdGVdXHJcbiAgKVxyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPERvdE5ldGlmeUNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3sgdm1zLCBzdGF0ZXMsIHVwZGF0ZSB9fT5cclxuICAgICAge3Byb3BzLmNoaWxkcmVufVxyXG4gICAgPC9Eb3ROZXRpZnlDb250ZXh0LlByb3ZpZGVyPlxyXG4gIClcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZURvdE5ldGlmeTxUPihtb2RlbDogc3RyaW5nLCBpbml0aWFsU3RhdGU6IFQpIHtcclxuICBjb25zdCB7IHZtcywgc3RhdGVzLCB1cGRhdGUgfSA9IHVzZUNvbnRleHQoRG90TmV0aWZ5Q29udGV4dClcclxuXHJcbiAgaWYgKCFzdGF0ZXMuY3VycmVudFttb2RlbF0pIHtcclxuICAgIHVwZGF0ZShtb2RlbCwgaW5pdGlhbFN0YXRlKVxyXG4gIH1cclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGxldCB2bSA9IHZtcy5jdXJyZW50W21vZGVsXVxyXG5cclxuICAgIGlmICh2bSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHtcclxuICAgICAgICBzdGF0ZTogc3RhdGVzLmN1cnJlbnRbbW9kZWxdLFxyXG4gICAgICAgIHNldFN0YXRlOiAobmV3U3RhdGU6IFQpID0+IHtcclxuICAgICAgICAgIHVwZGF0ZShtb2RlbCwgbmV3U3RhdGUpXHJcbiAgICAgICAgfSxcclxuICAgICAgfVxyXG5cclxuICAgICAgdm0gPSBkb3RuZXRpZnkucmVhY3QuY29ubmVjdChtb2RlbCwgY29tcG9uZW50IGFzIENvbXBvbmVudCwge1xyXG4gICAgICAgIGdldFN0YXRlOiAoKSA9PiBzdGF0ZXMuY3VycmVudFttb2RlbF0sXHJcbiAgICAgICAgc2V0U3RhdGU6IG5ld1N0YXRlID0+IHtcclxuICAgICAgICAgIHVwZGF0ZShtb2RlbCwgbmV3U3RhdGUpXHJcbiAgICAgICAgfSxcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gKCkgPT4gdm0gJiYgdm0uJGRlc3Ryb3koKVxyXG4gIH0sIFttb2RlbCwgdm1zLCBzdGF0ZXMsIHVwZGF0ZV0pXHJcblxyXG4gIHJldHVybiBbc3RhdGVzLmN1cnJlbnRbbW9kZWxdLCB2bXMuY3VycmVudFttb2RlbF1dXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1c2VQcm9wZXJ0eShtb2RlbDogc3RyaW5nLCBwcm9wZXJ0eTogc3RyaW5nKSB7XHJcbiAgY29uc3QgeyB2bXMsIHN0YXRlcyB9ID0gdXNlQ29udGV4dChEb3ROZXRpZnlDb250ZXh0KVxyXG4gIGNvbnN0IFt2YWx1ZSwgc2V0VmFsdWVdID0gdXNlU3RhdGUoc3RhdGVzLmN1cnJlbnRbbW9kZWxdW3Byb3BlcnR5XSlcclxuICBjb25zdCBkaWRDaGFuZ2UgPSB1c2VSZWYoZmFsc2UpXHJcblxyXG4gIGNvbnN0IHVwZGF0ZSA9ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICBzZXRWYWx1ZSh2YWx1ZSlcclxuICAgIGRpZENoYW5nZS5jdXJyZW50ID0gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgY29uc3QgZGlzcGF0Y2ggPSAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgZGVidWdnZXJcclxuICAgIGlmICh2bXMuY3VycmVudFttb2RlbF0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gZGlzcGF0Y2gsIHZtIGhhcyBub3QgYmVlbiBpbml0aWFsaXplZC5cIilcclxuICAgIH1cclxuXHJcbiAgICB2bXMuY3VycmVudFttb2RlbF0uJGRpc3BhdGNoKHsgW3Byb3BlcnR5XTogdmFsdWUgfSlcclxuICAgIGRpZENoYW5nZS5jdXJyZW50ID0gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgY29uc3Qgc3RhdGUgPSBzdGF0ZXMuY3VycmVudFttb2RlbF1cclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh2YWx1ZSAhPT0gc3RhdGVbcHJvcGVydHldICYmICFkaWRDaGFuZ2UuY3VycmVudCkge1xyXG4gICAgICBzZXRWYWx1ZShzdGF0ZVtwcm9wZXJ0eV0pXHJcbiAgICAgIGRpZENoYW5nZS5jdXJyZW50ID0gZmFsc2VcclxuICAgIH1cclxuICB9LCBbbW9kZWwsIHByb3BlcnR5LCBzdGF0ZSwgdmFsdWVdKVxyXG5cclxuICByZXR1cm4gW3ZhbHVlLCB1cGRhdGUsIGRpc3BhdGNoXVxyXG59XHJcbiJdfQ==